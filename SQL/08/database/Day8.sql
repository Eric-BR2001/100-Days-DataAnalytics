select t1.status,avg(t1.salary) from  (select ec.employee_id,ec.client,ec.revenue,ec.sales, en.first_name,en.last_name, es.salary,es.status, em.state from employee_clients ec  join employee_names en on ec.employee_id=en.employee_id join employee_status es on es.employee_id=ec.employee_id join employee_state_manager em on em.employee_id=en.employee_id) t1 group by t1.status
select COUNT(t1.employee_id),t1.state from  (select ec.employee_id,ec.client,ec.revenue,ec.sales, en.first_name,en.last_name, es.salary,es.status, em.state from employee_clients ec  join employee_names en on ec.employee_id=en.employee_id join employee_status es on es.employee_id=ec.employee_id join employee_state_manager em on em.employee_id=en.employee_id) t1 group by t1.state
select t1.state,SUM(t1.revenue) from  (select ec.employee_id,ec.client,ec.revenue,ec.sales, en.first_name,en.last_name, es.salary,es.status, em.state from employee_clients ec  join employee_names en on ec.employee_id=en.employee_id join employee_status es on es.employee_id=ec.employee_id join employee_state_manager em on em.employee_id=en.employee_id) t1 group by t1.state order by SUM(t1.revenue) desc limit 7;
SELECT ec.employee_id, en.first_name, en.last_name, SUM(ec.revenue)-SUM(es.salary) AS difference_salary_revenue FROM employee_clients ec JOIN employee_names en ON ec.employee_id=en.employee_id JOIN employee_status es ON es.employee_id=en.employee_id JOIN employee_state_manager em ON em.employee_id=en.employee_id GROUP BY ec.employee_id, en.first_name, en.last_name HAVING SUM(ec.revenue)-SUM(es.salary) < 0
